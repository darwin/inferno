// NV38Box (http://inferno.hildebrand.cz)
// Copyright (c) 2004 Antonin Hildebrand
// licensed under zlib/libpng license (see license.txt)
// released in Shader Triathlon – Summer 2004 ("Contest")

// THIS FILE IS SHARED BETWEEN C++ APPLICATION AND Cg SHADERS

#define HARDDEPTH(z) ((z)*2.0f-1.0f)

////////////////////////////////////////////////////////////////////
// raytracer rforce
 
#define RTRF_MAX_LIGHTS 2
#define RTRF_SPECULAR_POWER 16
#define RTRF_SPECULAR_COLOR float3(1,1,1) // white

//! min = 32x32
//  max = 256x256 nebo vice se snizenym RTRF_SEGMENT_S?
#define RTRF_VIEWPORT_SX 128
#define RTRF_VIEWPORT_SY 128
#define RTRF_VIEWPORT_SIZE (RTRF_VIEWPORT_SX*RTRF_VIEWPORT_SY)
  
// MEM LIMIT 256M
//#define RTRF_SEGMENT_SX 2048 
//#define RTRF_SEGMENT_SY 2048

// MEM LIMIT 64M
#define RTRF_SEGMENT_SX 1024 
#define RTRF_SEGMENT_SY 1024

#define RTRF_SEGMENT_SIZE (RTRF_SEGMENT_SX*RTRF_SEGMENT_SY)

#define RTRF_TRIMAP_SX 32
#define RTRF_TRIMAP_SY 32 // must be same as RTRF_TRIMAP_SX (we are using glPointSize)
#define RTRF_TRIMAP_SIZE ((RTRF_TRIMAP_SX)*(RTRF_TRIMAP_SY))

#define RTRF_BVMAP_SX 4
#define RTRF_BVMAP_SY 4
#define RTRF_BVMAP_SIZE (RTRF_BVMAP_SX*RTRF_BVMAP_SY)

#define RTRF_SEGMENTS_X ((RTRF_VIEWPORT_SX*RTRF_TRIMAP_SX) / RTRF_SEGMENT_SX)
#define RTRF_SEGMENTS_Y ((RTRF_VIEWPORT_SY*RTRF_TRIMAP_SY) / RTRF_SEGMENT_SY)
#define RTRF_SEGMENTS_SIZE (RTRF_SEGMENTS_X*RTRF_SEGMENTS_Y)

#define RTRF_WORKSPACE_SX (RTRF_SEGMENT_SX+RTRF_VIEWPORT_SX)
#define RTRF_WORKSPACE_SY (RTRF_SEGMENT_SY+RTRF_VIEWPORT_SY)
#define RTRF_WORKSPACE_SIZE (RTRF_WORKSPACE_SX*RTRF_WORKSPACE_SY)

#define RTRF_VBO_SCENE_VERTEX_SIZE (3 + 3 + 4 + 2 + 4 + 4) // V+N+Mat+UV+COLOR+ADDR

#define RTRF_BVELEMENT_SX (RTRF_TRIMAP_SX/RTRF_BVMAP_SX) 
#define RTRF_BVELEMENT_SY (RTRF_TRIMAP_SY/RTRF_BVMAP_SY)
#define RTRF_BVELEMENT_SIZE (RTRF_BVELEMENT_SX*RTRF_BVELEMENT_SY)

#define RTRF_INTERSECTING_SPACE_SX (RTRF_WORKSPACE_SX+RTRF_VIEWPORT_SX)
#define RTRF_INTERSECTING_SPACE_SY (RTRF_WORKSPACE_SY)

#define RTRF_BOUNDTESTING_SPACE_SX (RTRF_BVMAP_SX*RTRF_VIEWPORT_SX)
#define RTRF_BOUNDTESTING_SPACE_SY (RTRF_BVMAP_SY*RTRF_VIEWPORT_SY)

#define RTRF_MARKMEMORY_SX (RTRF_BOUNDTESTING_SPACE_SX)
#define RTRF_MARKMEMORY_SY (RTRF_BOUNDTESTING_SPACE_SY)
#define RTRF_MARKMEMORY_COMPONENTS 1
#define RTRF_MARKMEMORY_SIZE (RTRF_MARKMEMORY_COMPONENTS*RTRF_MARKMEMORY_SX*RTRF_MARKMEMORY_SY*sizeof(float))

// buffer placement
#define RTRF_BUFFER_RAYSTART_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_RAYSTART_PY (0)
#define RTRF_BUFFER_RAYSTART_SX (RTRF_VIEWPORT_SX)
#define RTRF_BUFFER_RAYSTART_SY (RTRF_VIEWPORT_SY)

#define RTRF_BUFFER_RAYDIRECTION_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_RAYDIRECTION_PY (RTRF_VIEWPORT_SY)
#define RTRF_BUFFER_RAYDIRECTION_SX (RTRF_VIEWPORT_SX)
#define RTRF_BUFFER_RAYDIRECTION_SY (RTRF_VIEWPORT_SY)

#define RTRF_BUFFER_TRANSFORMEDAPOSITION_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_TRANSFORMEDAPOSITION_PY (RTRF_BUFFER_RAYDIRECTION_PY+RTRF_BUFFER_RAYDIRECTION_SY+0*RTRF_TRIMAP_SY)
#define RTRF_BUFFER_TRANSFORMEDAPOSITION_SX (RTRF_TRIMAP_SX)
#define RTRF_BUFFER_TRANSFORMEDAPOSITION_SY (RTRF_TRIMAP_SY)

#define RTRF_BUFFER_TRANSFORMEDBPOSITION_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_TRANSFORMEDBPOSITION_PY (RTRF_BUFFER_RAYDIRECTION_PY+RTRF_BUFFER_RAYDIRECTION_SY+1*RTRF_TRIMAP_SY)
#define RTRF_BUFFER_TRANSFORMEDBPOSITION_SX (RTRF_TRIMAP_SX)
#define RTRF_BUFFER_TRANSFORMEDBPOSITION_SY (RTRF_TRIMAP_SY)

#define RTRF_BUFFER_TRANSFORMEDCPOSITION_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_TRANSFORMEDCPOSITION_PY (RTRF_BUFFER_RAYDIRECTION_PY+RTRF_BUFFER_RAYDIRECTION_SY+2*RTRF_TRIMAP_SY)
#define RTRF_BUFFER_TRANSFORMEDCPOSITION_SX (RTRF_TRIMAP_SX)
#define RTRF_BUFFER_TRANSFORMEDCPOSITION_SY (RTRF_TRIMAP_SY)

#define RTRF_BUFFER_TRANSFORMEDANORMAL_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_TRANSFORMEDANORMAL_PY (RTRF_BUFFER_RAYDIRECTION_PY+RTRF_BUFFER_RAYDIRECTION_SY+3*RTRF_TRIMAP_SY)
#define RTRF_BUFFER_TRANSFORMEDANORMAL_SX (RTRF_TRIMAP_SX)
#define RTRF_BUFFER_TRANSFORMEDANORMAL_SY (RTRF_TRIMAP_SY)

#define RTRF_BUFFER_TRANSFORMEDBNORMAL_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_TRANSFORMEDBNORMAL_PY (RTRF_BUFFER_RAYDIRECTION_PY+RTRF_BUFFER_RAYDIRECTION_SY+4*RTRF_TRIMAP_SY)
#define RTRF_BUFFER_TRANSFORMEDBNORMAL_SX (RTRF_TRIMAP_SX)
#define RTRF_BUFFER_TRANSFORMEDBNORMAL_SY (RTRF_TRIMAP_SY)

#define RTRF_BUFFER_TRANSFORMEDCNORMAL_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_TRANSFORMEDCNORMAL_PY (RTRF_BUFFER_RAYDIRECTION_PY+RTRF_BUFFER_RAYDIRECTION_SY+5*RTRF_TRIMAP_SY)
#define RTRF_BUFFER_TRANSFORMEDCNORMAL_SX (RTRF_TRIMAP_SX)
#define RTRF_BUFFER_TRANSFORMEDCNORMAL_SY (RTRF_TRIMAP_SY)

#define RTRF_BUFFER_TRANSFORMEDAREA_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_TRANSFORMEDAREA_PY (RTRF_BUFFER_RAYDIRECTION_PY+RTRF_BUFFER_RAYDIRECTION_SY)
#define RTRF_BUFFER_TRANSFORMEDAREA_SX (RTRF_TRIMAP_SX)
#define RTRF_BUFFER_TRANSFORMEDAREA_SY (6*RTRF_TRIMAP_SY)
#define RTRF_BUFFER_TRANSFORMEDAREA_HALF_SY (3*RTRF_TRIMAP_SY)

#define RTRF_BUFFER_BOUNDINGVOLUMESMIN_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_BOUNDINGVOLUMESMIN_PY (RTRF_BUFFER_TRANSFORMEDAREA_PY+RTRF_BUFFER_TRANSFORMEDAREA_SY)
#define RTRF_BUFFER_BOUNDINGVOLUMESMIN_SX (RTRF_BVMAP_SX)
#define RTRF_BUFFER_BOUNDINGVOLUMESMIN_SY (RTRF_BVMAP_SY)

#define RTRF_BUFFER_BOUNDINGVOLUMESMAX_PX (RTRF_WORKSPACE_SX)
#define RTRF_BUFFER_BOUNDINGVOLUMESMAX_PY (RTRF_BUFFER_BOUNDINGVOLUMESMIN_PY+3*RTRF_TRIMAP_SY)
#define RTRF_BUFFER_BOUNDINGVOLUMESMAX_SX (RTRF_BVMAP_SX)
#define RTRF_BUFFER_BOUNDINGVOLUMESMAX_SY (RTRF_BVMAP_SY)
